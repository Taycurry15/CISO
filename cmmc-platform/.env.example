# CMMC Compliance Platform - Environment Configuration
# Copy this file to .env and fill in your values

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=postgresql://cmmc_admin:your_secure_password@localhost:5432/cmmc_platform
POSTGRES_USER=cmmc_admin
POSTGRES_PASSWORD=<GENERATE: openssl rand -base64 32>
POSTGRES_DB=cmmc_platform

# Admin bootstrap (used by scripts/create_admin.py)
CMMC_DB_HOST=localhost
CMMC_DB_PORT=5432
CMMC_DB_USER=${POSTGRES_USER}
CMMC_DB_PASSWORD=${POSTGRES_PASSWORD}
CMMC_DB_NAME=${POSTGRES_DB}
CMMC_ADMIN_EMAIL=admin@example.com
CMMC_ADMIN_PASSWORD=<SET: strong password for first login>
CMMC_ADMIN_NAME=Admin User

# ============================================================================
# AI PROVIDER CONFIGURATION
# ============================================================================

# AI Provider: "openai" or "anthropic"
AI_PROVIDER=openai

# AI Model Selection:
# For OpenAI: gpt-4-turbo-preview, gpt-4o, gpt-4, gpt-3.5-turbo
# For Anthropic: claude-3-5-sonnet-20241022, claude-3-opus-20240229, claude-3-sonnet-20240229
AI_MODEL=gpt-4-turbo-preview

# API Key for AI provider
# OpenAI: Get from https://platform.openai.com/api-keys
# Anthropic: Get from https://console.anthropic.com/
AI_API_KEY=sk-your-api-key-here

# ============================================================================
# EMBEDDING CONFIGURATION
# ============================================================================

# Embedding Provider: "openai" or "sentence_transformers"
EMBEDDING_PROVIDER=openai

# Embedding Model:
# For OpenAI: text-embedding-3-small (1536 dim), text-embedding-3-large (3072 dim), text-embedding-ada-002 (1536 dim)
# For Sentence Transformers: all-MiniLM-L6-v2 (384 dim), all-mpnet-base-v2 (768 dim)
EMBEDDING_MODEL=text-embedding-3-small

# Embedding API Key (if different from AI_API_KEY, otherwise leave blank)
EMBEDDING_API_KEY=

# ============================================================================
# OBJECT STORAGE
# ============================================================================

# Path for evidence file storage
OBJECT_STORAGE_PATH=/var/cmmc/evidence

# MinIO Configuration (S3-compatible object storage)
MINIO_ENDPOINT=minio:9000
MINIO_ROOT_USER=cmmc-admin
MINIO_ROOT_PASSWORD=<GENERATE: openssl rand -base64 32>
MINIO_BUCKET_NAME=cmmc-evidence
MINIO_USE_SSL=false

# ============================================================================
# REDIS / CELERY (Background Tasks)
# ============================================================================

# Note: Redis URLs are automatically constructed with authentication
# REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
# CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
# CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/0

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================

# Environment: development, staging, production
ENVIRONMENT=development

# API Settings
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4

# CORS Allowed Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# JWT Secret (CRITICAL - REQUIRED)
# Generate with: openssl rand -hex 32
JWT_SECRET=<GENERATE: openssl rand -hex 32>

# JWT token expiration (in minutes)
JWT_EXPIRATION_MINUTES=60

# Refresh token expiration (in days)
REFRESH_TOKEN_EXPIRE_DAYS=30

# Password hashing rounds (12 is recommended, higher = more secure but slower)
BCRYPT_ROUNDS=12

# Redis password (REQUIRED for security)
REDIS_PASSWORD=<GENERATE: openssl rand -base64 32>

# MinIO encryption key (REQUIRED for server-side encryption)
MINIO_KMS_SECRET_KEY=<GENERATE: openssl rand -base64 32>

# CORS Allowed Origins (comma-separated, NO SPACES)
# Examples:
#   Development: http://localhost:3000,http://localhost:8080
#   Production: https://app.example.com,https://dashboard.example.com
CORS_ALLOWED_ORIGINS=http://localhost:3000

# ============================================================================
# INTEGRATIONS
# ============================================================================

# Nessus Integration
NESSUS_MODE=api  # or "file"
NESSUS_BASE_URL=https://cloud.tenable.com
NESSUS_ACCESS_KEY=
NESSUS_SECRET_KEY=
NESSUS_EXPORT_PATH=/var/cmmc/nessus_exports

# Splunk Integration (coming soon)
SPLUNK_HOST=
SPLUNK_PORT=8089
SPLUNK_TOKEN=
SPLUNK_INDEX=main

# Azure Integration (coming soon)
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=
AZURE_SUBSCRIPTION_ID=

# AWS Integration (coming soon)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-gov-west-1

# M365 Integration (coming soon)
M365_TENANT_ID=
M365_CLIENT_ID=
M365_CLIENT_SECRET=

# ============================================================================
# LOGGING
# ============================================================================

LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

# Sentry Error Tracking (optional)
SENTRY_DSN=

# Application Insights (optional)
APPINSIGHTS_INSTRUMENTATION_KEY=

# ============================================================================
# ADVANCED AI SETTINGS
# ============================================================================

# AI Temperature (0.0-1.0, lower = more deterministic)
AI_TEMPERATURE=0.1

# Max tokens for AI responses
AI_MAX_TOKENS=4000

# RAG Settings
RAG_TOP_K=10  # Number of document chunks to retrieve
RAG_SIMILARITY_THRESHOLD=0.7  # Minimum cosine similarity (0-1)
RAG_CHUNK_SIZE=1000  # Characters per chunk
RAG_CHUNK_OVERLAP=200  # Overlap between chunks

# AI Retry Settings
AI_MAX_RETRIES=3
AI_TIMEOUT=60

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable/disable AI-assisted analysis
ENABLE_AI_ANALYSIS=true

# Enable/disable RAG retrieval
ENABLE_RAG=true

# Enable/disable provider inheritance lookups
ENABLE_PROVIDER_INHERITANCE=true

# Enable/disable diagram extraction
ENABLE_DIAGRAM_EXTRACTION=false

# ============================================================================
# COST OPTIMIZATION
# ============================================================================

# Use local embeddings instead of API (set EMBEDDING_PROVIDER=sentence_transformers)
USE_LOCAL_EMBEDDINGS=false

# Cache AI responses (requires Redis)
CACHE_AI_RESPONSES=true
AI_CACHE_TTL=3600

# ============================================================================
# DEPLOYMENT (Hetzner)
# ============================================================================

# Domain name
DOMAIN=your-domain.com

# SSL/TLS Certificate paths
SSL_CERT_PATH=/etc/letsencrypt/live/your-domain.com/fullchain.pem
SSL_KEY_PATH=/etc/letsencrypt/live/your-domain.com/privkey.pem

# Email for Let's Encrypt
LETSENCRYPT_EMAIL=admin@your-domain.com

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

# Database backup configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=

# ============================================================================
# COMPLIANCE & AUDIT
# ============================================================================

# Enable audit logging
ENABLE_AUDIT_LOG=true

# Audit log retention (days)
AUDIT_LOG_RETENTION=2555  # 7 years for CMMC

# Enable chain-of-custody tracking
ENABLE_CHAIN_OF_CUSTODY=true
